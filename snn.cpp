#include "snn.h"
#include "fstream"
using namespace std;

#include <ap_int.h>
#include <ap_fixed.h>

typedef ap_uint<1> uint1_t;
typedef ap_fixed<16, 4> float24_t;

uint1_t act_fun(float24_t mem){
    
    if(mem > (float24_t)0.4) return 1;
    else return 0;
}

// float mat_mul(int spk[2], float weight[96]){

// }

// full-connected 2*32
void fc1(uint1_t ecg1, uint1_t ecg2, float24_t *mem1, uint1_t *spike1, float24_t *weight){
    Fc1Loop:
    for(int i=0; i<32; i++){
        mem1[i] = mem1[i]*0.95*(1.0-spike1[i]) + ecg1*weight[0+i*2] + ecg2*weight[1+i*2] + weight[64+i];
        spike1[i] = act_fun(mem1[i]);
    }
}

// full-connected 32*32
void fc2(uint1_t spike_in[32], float24_t *mem2, uint1_t *spike2, float24_t *weight){
    for(int i=0; i<32; i++){
        mem2[i] = mem2[i]*0.95*(1.0-spike2[i]);
        for(int j=0; j<32; j++){
            mem2[i] += spike_in[j]*weight[96+j+i*32];
        }
        mem2[i] += weight[1120+i];
        spike2[i] = act_fun(mem2[i]);
    }
}

// full-connected 32*32
void fc3(uint1_t spike_in[32], float24_t *mem3, uint1_t *spike3, float24_t *weight){
    for(int i=0; i<32; i++){
        mem3[i] = mem3[i]*0.95*(1.0-spike3[i]);
        for(int j=0; j<32; j++){
            mem3[i] += spike_in[j]*weight[1152+j+i*32];
        }
        mem3[i] += weight[2176+i];
        spike3[i] = act_fun(mem3[i]);
    }
}

// full-connected 32*4
void fc4(uint1_t spike_in[32], float24_t *mem_out, uint1_t *spike_out, float24_t *weight){
    for(int i=0; i<4; i++){
        mem_out[i] = mem_out[i]*0.95*(1.0-spike_out[i]);
        for(int j=0; j<32; j++){
            mem_out[i] += spike_in[j]*weight[2208+j+i*32];
        }
        mem_out[i] += weight[2336+i];
        spike_out[i] = act_fun(mem_out[i]);
    }
}

void SNN_infer(uint1_t ecg[260], uint1_t *result){
    // int ecg1[130], ecg2[130];   // ECG杈撳叆
    // float data[2340];    //鏉冮噸鍜屽亸锟�?2*32*32*32*4
    // (32, 2) (32,) (32, 32) (32,) (32, 32) (32,) (4, 32) (4,)
    // extern float data[2340];
    float24_t data[2340]={1.63514, 1.4911, 0.979609, 0.978, 0.053385, -6.59964, -8.82557, -2.7038, -1.12408, 1.10139, 0.645208, 1.82775, 1.02078, 0.918135, -1.89074, 1.49821, -1.43619, 0.617251, -2.72622, 1.24602, 0.507552, -1.00004, -2.82907, 0.895899, -2.1829, -0.507107, 1.48115, 3.31434, -0.531501, -0.738665, 1.05897, -0.686401, -2.15106, 0.715512, -2.62323, 0.494943, 1.2069, 1.18493, -0.277063, 1.30199, -2.53522, 1.10858, 0.185645, -1.57148, -0.854801, -0.682689, -1.06339, 1.32227, 0.0709905, -1.17284, -0.0260011, 0.961859, -0.767336, 0.73833, 0.876375, -0.82494, 0.501055, 13.0278, 0.622171, 1.60537, -1.96322, 1.90125, 0.875029, -0.273208, -0.191328, -0.559504, 0.09326, 0.123411, 0.00229785, -0.127792, 0.013418, -0.04952, -0.0373384, 0.0112199, -0.34852, 0.0373653, 0.115977, -0.250637, -0.440233, 0.062974, 0.000269083, -0.540502, 0.0139213, -0.201129, 0.0225829, -0.479743, 0.530167, -0.189294, -0.565823, -0.191736, 0.509345, -0.177545, -0.101994, -0.113111, -0.0591012, -0.0655063, -0.051138, -0.0102507, -0.0586488, 0.104498, -0.290103, -0.123378, -0.084969, -0.147553, -0.155317, -0.0398393, 0.029516, -0.0342182, -0.0238368, -0.103122, -0.0797598, -0.0964458, -0.0219914, -0.0429032, -0.0541901, -0.0477172, -0.117628, 0.0598849, 0.000528816, 0.0283879, 0.00539481, -0.00756221, -0.111658, 0.0460189, 0.00292478, -0.00737486, 0.0288893, -0.0570375, -0.055415, -0.123756, -0.191055, -0.234119, -0.021609, -0.112648, -0.0946871, -0.0633256, -0.0972992, -0.074079, 0.0767014, -0.054013, -0.03393, -0.14372, 0.0876326, -0.0824143, -0.0860939, -0.00347414, -0.168599, -0.0868314, -0.150895, 0.0143198, -0.0900784, -0.0454471, -0.032697, -0.0184671, -0.101214, 0.0044735, -0.0373445, -0.127652, -0.075805, 0.0555845, -0.247451, -0.15031, 0.0183479, 0.0513482, -0.014916, -0.170403, -0.158347, -0.160228, -0.141961, -0.244063, -0.0726512, -0.225923, -0.223747, -0.18726, -0.0405767, -0.0156217, -0.259665, 0.00248805, -0.258683, -0.144177, -0.102949, 0.00855883, -0.0201169, -0.0920651, 0.0597941, -0.103854, 0.0275319, -0.0624946, -0.217964, -0.147973, -0.176173, -0.0951291, -0.122055, -0.0838612, -0.179855, 0.50623, 0.219576, -0.112657, 0.000473211, -0.140752, 0.861834, -0.527895, -0.0144113, -0.20246, 0.2664, -0.082659, -0.0489056, 0.0825849, 0.948272, -0.0575749, -0.0135623, 0.0383267, 0.0186522, 0.0976022, -0.236132, -0.273726, 0.0316597, 0.0713973, 0.234171, -0.00512083, 0.00566995, -0.0786596, 3.86258, 0.0609021, -0.0733847, 0.0589079, 0.011324, 0.0600692, -0.0798429, 0.036665, -0.0618019, 0.0121209, 0.0205647, -0.0141141, -0.0793771, -0.00190069, -0.0503532, 0.0849054, 0.0517665, 0.0223765, -0.0386972, 0.0382393, 0.0057381, -0.0626235, 0.0234811, 0.0520593, 0.00803896, -0.035355, -0.0761415, -0.0633586, -0.0983302, 0.0710548, -0.0174606, 0.0671884, -0.0626376, -0.0387962, -0.0106629, -0.025827, -0.0671392, -0.0608126, -0.0541113, -0.102962, 0.0214032, -0.0587799, -0.0477153, 0.0178828, -0.0477456, -0.0369158, 0.0694264, -0.0177821, 0.0401966, 0.0392852, 0.0769932, 0.0467773, -0.0169553, -0.0217659, 0.0698057, 0.066685, -0.101694, -0.0315005, 0.000440087, 0.0353339, -0.0137515, -0.072361, -0.0021251, -0.0988474, 0.024261, -0.0463898, 0.175668, -0.875754, 1.22651, 1.60112, 0.03912, -0.0347377, 0.129728, 0.565381, -0.733233, -0.463302, -0.0793694, -1.05695, 0.0817217, -0.182739, 0.0708183, -0.0360763, -2.90348, 0.115871, 0.0460242, -0.527596, -0.736971, 0.0565532, -0.308718, -0.374407, 0.0719971, -0.27933, 0.227061, -0.036861, 0.160479, 0.0515383, -2.36567, -1.70382, -0.275933, 0.827902, -0.311788, -0.78238, 0.384506, -0.154437, 0.0960113, -0.584768, 1.11632, -0.60293, -0.0690744, -0.162001, 0.0179056, -0.40191, -0.0576747, 0.0465144, -0.509782, 0.0314533, 0.0906732, -0.0399826, -0.0507442, 0.0414988, -0.310475, -2.22674, 0.0464276, 0.0337207, 0.126318, 0.0714043, 0.169046, -0.181164, -0.170847, 0.269211, 0.0528144, 0.385783, 0.857379, -0.0740166, 0.053582, 0.130691, -0.0502086, 0.200954, -0.827908, 0.11197, -0.0229863, 1.5393, -0.114817, 0.019871, 0.0729779, -0.0747576, -1.29619, -0.0594949, -0.0249671, -0.221209, 0.536815, 0.0338551, 0.0591118, 0.3872, 0.0103195, 0.0552539, 0.0675023, -0.0137063, 0.0727539, 0.0513973, -1.90283, -0.335938, 0.0931, 0.3142, -6.02716, -1.3167, 0.135388, 0.179804, 0.215439, 0.494309, 0.0267811, 0.576112, 0.0842425, 0.373316, -1.44835, 0.147849, 0.0602652, 1.0624, -0.377529, 0.0834255, 0.143417, -0.173289, 0.522839, -0.0302973, -0.235819, -0.247216, 0.0104558, -0.0540233, -0.118021, -0.0302957, 0.28727, 0.261511, -2.16881, -0.127832, -0.01821, -0.101945, -0.0611128, -0.0330363, 0.0601993, 0.0185679, 0.00484366, -0.0786733, 0.0792171, 0.0628212, 0.049749, -0.0472005, 0.0983584, -0.0678008, 0.0891381, -0.0107535, 0.0255499, 0.0228392, 0.0042937, -0.00303515, -0.0944415, 0.00252286, -0.0739479, 0.0606329, 0.0559552, 0.048886, -0.0669134, -0.0823771, -0.0752082, -0.0895229, 0.00151491, 0.0236444, 0.0387967, -0.619667, 0.823106, 1.20385, 1.22955, 0.0935866, 0.179657, 0.737916, 0.532414, 0.720359, -0.0405218, 0.212601, 1.38442, 0.111777, -0.010123, 0.380832, 0.101035, 0.0618871, 0.17929, 0.115682, 0.374538, 0.0530024, 0.0958676, 0.377951, 0.0798524, 0.207102, -0.0457292, -0.0715909, 0.221932, 0.0847109, -2.58485, 0.60164, -0.0319938, 0.820904, 0.424616, 0.209365, -0.475942, -0.111647, 0.0549612, -0.0636112, -2.20632, -0.0253543, 0.013246, -0.179787, -0.55502, 0.022359, -0.0573579, 0.136996, -0.362185, -0.0240727, 0.0340794, 0.00546766, -0.473884, 0.0262203, -0.0906097, 0.301704, -0.0443159, 0.00850169, 0.00280645, 0.0665, -0.0309972, -0.0602607, -4.04238, 1.64952, -0.142095, -0.27239, 1.52396, 2.01321, 0.166823, 0.130976, 0.0541406, -0.0530398, -2.35758, -0.296397, -0.0909995, -0.0272257, -0.199747, 0.225503, 0.0426453, -0.462935, -7.81566, 0.0692275, 0.0274729, -0.0514926, 0.336916, 0.0214984, -0.133761, 0.122171, -0.0221183, 0.0358306, 0.013517, 0.0150661, 0.0486705, 0.18642, -0.57461, -0.0628993, -0.212761, 0.734787, 1.30028, 1.46713, 0.624348, 0.00501619, 0.0171111, 0.120845, -5.68676, 0.341347, 0.013817, 0.0122488, -0.508754, 0.284447, 0.0587414, -0.288351, -5.41724, -0.0889108, -0.0192859, 0.231985, 0.116731, 0.0572907, 0.00477485, -0.139779, -0.0518376, 0.095759, 0.0544214, 0.0339327, -0.127497, 0.0365518, -1.15089, -0.0127795, -0.0587015, -0.0541969, 0.60116, 0.240843, 0.00820646, 0.00951627, 0.0133694, -0.000134502, -0.114509, -0.232659, -0.0574861, -0.082101, -0.44254, -0.145887, 0.0938157, 0.073575, -1.65378, -0.0862505, 0.0622338, -0.127714, -0.120681, -0.0578044, -0.108475, 0.255578, 0.0922462, -0.11335, 0.0423647, -0.0605913, -0.0848395, 0.0346099, -1.42077, -0.0206397, -0.0588799, -0.0306237, 0.0424511, -0.0438353, -0.0940836, -0.0437499, 0.0468876, -0.0817294, -0.0421317, -0.0475913, 0.0439093, -0.0759501, -0.0235111, -0.0790956, -0.0776948, 0.0365507, -0.0135643, 0.0700729, 0.0357016, -0.0260321, -0.0117405, -0.0428603, 0.0141243, 0.00288469, 0.00771481, -0.0528961, -0.00145889, 0.0690664, -0.0208865, 0.064028, -0.0480586, -0.079897, -0.033814, 0.185383, 0.713545, 0.564319, 0.307255, -0.149746, 0.0100844, -0.0102092, -3.86255, -0.383219, -0.057026, -1.52805, 0.647981, 0.159345, -0.0228035, -0.202041, -3.8653, 0.0889499, -0.0670994, 0.319392, -0.303909, -0.0369919, 0.00600417, 1.04151, 0.0768457, 0.354376, 0.0420006, -0.0123105, -0.0251951, -0.0804154, -0.793792, 0.375757, -0.122818, 0.0925645, -2.1993, 3.244, 0.118569, -0.12488, -0.0161199, 0.0376223, -2.01375, 0.0903701, 0.0243552, -0.208591, -0.0645484, 0.23294, 0.0447574, -0.249371, -5.75568, -0.0260298, -0.0519129, -0.0186252, -0.770842, -0.0427725, -0.0455866, 1.66332, 0.0614439, 0.0469084, 0.0499755, 0.0201417, -0.169585, 0.0999723, -1.78558, -0.0970359, -5.16597, -0.738041, 0.0646065, 0.00833768, -0.135921, -5.47952, -0.551107, -2.94691, -2.99326, -0.294535, 0.0646288, -0.193942, -0.267459, -6.02095, 0.0355898, -0.375766, 1.05436, -0.0243842, -0.434764, -1.79324, -0.459767, -0.0981316, 0.0783351, -2.95628, 0.0480001, 0.662038, 0.0205389, 0.0432362, -1.94089, -5.51703, -2.9355, 2.78599, 0.101616, -8.07702, -0.910238, 0.0267776, -0.149096, 0.0862703, -0.0979683, 0.00741007, -0.222998, 0.651594, -0.0885888, 0.175246, 0.904627, 0.0363948, -0.0455235, -0.565643, -0.267085, 0.0383724, -0.036239, 0.491813, -0.0540175, 0.0135403, 0.00192097, -4.97038, 0.00801091, 0.343883, 0.031186, 0.0649929, -0.270526, 0.00335283, 0.170234, -0.430219, -0.110259, -0.00671679, -0.103505, 0.0223161, -0.0115356, -0.0135893, 0.00668679, -0.0589298, -0.0911247, -0.00819111, 0.0966785, 0.00670622, -0.0371005, 0.0390944, 0.0325718, -0.103224, 0.0304323, 0.060767, -0.0563508, 0.0728967, 0.0222023, 0.0946331, 0.045631, -0.0139209, -0.0728968, 0.0471852, -0.0171301, 0.0520774, 0.0433074, 0.0268019, -0.0276145, -0.034392, -0.0544994, -0.0195534, 0.0547082, -0.045626, -0.0305914, -0.0606215, -0.00850351, -0.0150855, -0.0748671, -0.00176147, -0.0504185, 0.0667871, -0.0732102, -0.0177523, -0.0620082, 0.0131147, 0.0706607, 0.0601226, -0.024304, 0.0620313, -0.0141419, 0.0724134, 0.0789127, -0.0118396, -0.0347183, -0.0672834, -0.053772, 0.0596649, -0.0564956, 0.0187593, -0.0518211, 0.0159008, -0.0839099, 0.0180597, -0.0864363, -0.0447112, -0.00520798, -0.0443698, -0.0688936, 0.00572779, 0.0274389, -0.0818724, -0.075639, 0.0307394, -0.049177, -0.0827538, -0.0800248, 0.00803453, -0.0825657, 0.0366188, -0.065918, -0.029617, -0.0346958, -0.0840251, -0.03749, 0.0476883, -0.0292783, 0.0489333, -0.0411575, -0.0271053, -0.038731, -0.0109232, 0.0825286, -0.0316568, 0.00931259, 0.781524, -0.549178, -0.233587, -0.00104726, -0.0665952, 0.0695237, -0.824666, 1.37817, -0.787087, -0.0213065, 0.294315, 0.402441, -0.151024, 0.0247219, -0.0258277, 0.813409, -0.0797409, 0.0531915, -0.0193442, 0.257262, -0.0260455, -0.289708, -2.317, 0.0108157, 0.0138048, 0.183623, 0.0173416, 0.172663, 0.012381, -0.198024, -0.111885, 0.0406008, -0.0728767, -0.0745413, -0.0105691, -0.0558129, 0.0651578, 0.0114736, -0.0645703, -0.0584519, -0.00545217, 0.0437177, 0.0262486, -0.025535, -0.0139777, -0.0423938, 0.0701622, 0.0348844, 0.0419444, -0.0669572, 0.036847, -0.0154733, 0.0602733, -0.10218, 0.0356487, 0.0456714, -0.0835722, -0.115414, 0.0714747, 0.011844, -0.0368042, 0.0257218, 0.00500106, 0.239037, 0.454422, -0.21586, -0.255605, -0.0626001, 0.18637, 0.535686, -0.608761, -1.05794, -0.803801, -0.0503169, -0.136489, -0.634227, 0.465279, -0.0949978, 0.1553, -0.0237924, -0.0622914, 0.452318, -0.295407, 0.221332, 0.0698548, -0.138781, -0.544604, 0.0501611, -0.114896, 0.0621234, 0.0206471, 0.639317, 0.0996349, -1.55198, -0.935369, -0.118464, -0.0187613, -1.36608, -0.292242, -0.157645, -0.149943, -0.0211356, -0.742697, 1.9993, -0.89193, 0.0635127, -0.278487, -0.0144854, -0.0884831, -0.0190443, 0.0977565, 0.962258, -0.0611827, -0.0184814, 0.0926258, -0.203153, -0.0665678, -0.197393, -0.208797, 0.079774, -0.00684755, 0.127929, -0.0110772, 0.0126675, -0.109641, 3.24915, 0.0811192, -0.246583, 0.341951, -1.27376, -1.20614, -0.572096, -0.274263, 0.0759347, -0.574723, -5.56601, -0.882497, 0.00573403, -0.984415, -0.0818217, -0.113065, -0.0117595, 0.0868104, -0.688107, -0.0161129, 0.0776837, -0.151871, -0.94089, 0.0559194, -0.0755676, -0.0608766, -0.015418, 0.108116, 0.0346583, -0.0342862, 0.0252356, -0.236235, -6.69974, 0.624662, -0.146927, -0.181796, 0.952481, 1.4627, 0.477854, -0.138553, 0.113051, 0.560466, -6.487, 0.52388, -0.0625764, 0.20481, -0.588979, -0.188326, -0.00143029, -0.42505, 0.53449, 0.0690237, 0.0402066, 0.0161196, -0.0556032, -0.0307848, -0.103003, 0.171058, 0.0183394, -0.288474, 0.124976, -0.0602557, 0.0302825, -0.115219, -3.68724, 1.62878, -0.275166, -0.22239, -1.07097, -1.03208, 0.15423, -0.266767, -0.102911, 0.587726, 0.421587, 0.463267, -0.027938, -1.49077, -0.0775242, -0.230978, -0.078494, 0.068723, 0.308133, 0.089498, -0.135506, -0.108333, 0.0268037, -0.0579002, -0.179391, 0.352072, 0.0316718, -0.142133, 0.0878885, -0.0104787, -0.269514, -0.147391, 5.75731, 0.254404, 0.109449, -0.182846, -2.33916, -1.95284, -0.0893227, -0.0711193, 0.0635838, 1.55733, 0.689226, -0.922964, 0.0734415, -2.16329, 0.212844, -0.149794, -0.0688398, 0.0652637, -0.470591, -0.0259555, 0.0134707, 0.305505, -0.904668, 0.0045652, -0.0128308, 1.51622, 0.013132, 0.0569019, 0.0097752, -0.0707142, -0.143183, 0.0361118, 0.762985, -0.303797, 0.00878287, 0.0885242, -0.110008, 0.0424343, -0.0940732, -0.163705, 0.169541, 0.235313, -0.0189976, -0.0891145, -0.060492, -0.114652, 0.18808, 0.166159, -0.0148468, -0.137996, -0.18897, 0.117289, 0.0621608, 0.118203, 0.126761, -0.18378, -0.167707, -0.170791, 0.0597766, 0.0324332, 0.168052, 0.23526, 0.12602, 0.164706, 0.196538, 0.0500988, 0.0489379, 0.0680204, -0.05136, 0.0427535, 0.0799491, 0.0308791, -0.00187615, -0.0664787, 0.0234608, 0.0065548, -0.0252992, 0.0433246, -0.011753, 0.00119462, -0.0381151, 0.0212558, -0.0107571, 0.0682705, -0.0663091, -0.0699847, -0.0805223, 0.0254813, -0.0189532, -0.00489178, -0.0487857, -0.0601327, 0.0229106, 0.00915587, 0.069895, -0.04679, -0.0744666, 0.0328144, 0.0257632, -0.119747, -0.0330395, -0.0688234, -0.0532957, -0.0446503, -2.02977, -6.33015, 0.0237757, 0.0519838, 0.0305567, 0.0572864, -0.242616, 0.185099, 0.252333, -0.195609, 0.0121253, 0.048815, 0.440988, 0.421865, 0.259832, -0.103815, -0.0331853, 0.0313766, -3.77476, -0.0625021, -0.118377, -0.00984424, -0.387449, 0.115785, 0.0431217, 0.0776952, 0.118334, -0.0763724, -0.0167645, -0.327089, 0.0871022, -0.0169422, -0.176071, -2.31701, -0.113584, 0.661194, 0.0539437, 0.152397, -0.693224, -0.0667893, -0.235902, 0.194027, 0.0891683, -0.428672, -0.0507688, 0.0237556, 0.622852, -0.0485635, -0.051439, -0.058298, -0.787585, 0.0638334, 0.346022, -1.44814, -0.333291, -0.240415, 0.280105, -0.164717, -0.0572733, -0.000416242, 0.0852362, 0.00157403, 0.0564247, 0.105057, 0.00221791, 0.00619998, 0.0578105, -0.00441827, 0.11659, -0.0707195, -0.00763695, 0.0781621, 0.0341888, -0.0695697, 0.098804, -0.0290362, -0.00530534, -0.0378768, 0.0137076, 0.0722461, 0.057661, -0.0467603, 0.060543, 0.0461639, -0.0819473, -0.120388, 0.0289738, -0.109675, 0.0196589, 0.0140331, 0.0933759, 0.0632002, 0.0238454, 0.113558, 0.0639125, 0.0882138, -0.0806492, -0.0390002, -0.0164353, -0.00584756, 0.00849152, -0.0658272, -0.0532699, -0.0165928, -0.0168124, 0.0176008, 0.0228485, -0.108764, -0.00167819, 0.0345531, -0.196779, -0.0541673, 0.0739278, 0.0910327, -0.0783762, 0.0414576, 0.0569461, 0.00124181, 0.0406555, -0.0156845, -0.10808, -0.124115, -0.0247371, 0.0557951, 0.0427402, -0.485286, -0.00613745, 0.0101113, -0.060528, 0.540531, 0.0923963, 1.74425, -0.0554223, 0.13589, 0.0968505, 0.28731, 0.492815, 0.173933, -0.0471213, -0.372448, 0.38918, 0.0233837, 0.180044, 0.0619245, 0.0406616, 0.0619289, 0.384147, 0.0358964, 0.185168, -0.404938, 0.0984263, -0.0373956, -0.91397, -0.872228, 0.0478424, 0.035279, -0.0271975, 0.0704526, 0.076754, 0.0237295, -0.0626296, -0.108439, -0.0661958, -0.0719154, -0.0575532, -0.066535, -0.0837431, -0.0832276, -0.105456, -0.0284123, -0.0430139, 0.0379551, 0.108367, 0.0185876, 0.0456614, 0.0082337, -0.03573, 0.0789664, -0.0302058, -0.0380414, 0.00372476, -0.00669267, -0.0195071, 0.00376715, -0.0062728, -0.05877, -0.145334, -0.037684, 0.133088, 0.101549, 0.0658432, -0.0498501, 0.850401, 0.191826, -0.0286254, 2.64797, 0.0209125, 0.297756, 0.344641, -0.732479, -0.650739, -0.424428, -0.0499508, -0.113236, -0.629592, -0.686847, -0.0267786, 0.0616097, -0.0781455, -0.0347568, 0.0354438, 0.0705646, -0.132184, -0.0308005, -1.67534, 0.0933512, -0.0504303, -0.330549, 0.0206803, -0.0639644, 0.0318512, -0.323908, 0.0392701, -0.0273618, -0.0856051, -0.687932, -0.301244, -0.665475, -0.0268544, -0.393167, -0.00037008, 0.356186, 1.5082, 0.47793, 0.0242684, -0.108513, 2.19262, 0.147983, 0.43228, 0.0508125, 0.00144929, -0.0239672, -0.35877, -0.071787, 0.398048, -0.297057, 0.752913, 0.0554814, 0.565864, -0.444192, 0.0655676, -0.0299647, 0.140123, -2.20998, 0.0808705, 0.0584862, -0.947954, 0.141579, 0.0962059, 0.907667, -0.0038658, 0.12047, -0.144362, -0.0782407, 0.362526, 0.178505, 0.0813678, 0.0792901, -0.0393458, 0.481034, 0.726154, 0.0613759, -0.0726707, -0.0231631, 0.303044, -0.00669856, 0.313449, 0.150901, 0.648256, -0.215614, 0.412212, 0.350532, -0.0888745, -0.035373, 0.0820369, -0.938172, -0.0791428, -0.000550175, -0.519804, -0.431752, -0.133122, -0.157876, 0.0227626, 0.55234, -0.40797, -0.310354, -0.0139897, 0.400357, 0.0687642, 0.262935, -0.516119, 0.26878, -0.0544849, -0.116736, 0.0376913, -0.0923839, -0.183983, 0.0856618, 0.647473, -1.71875, 0.396717, -0.353226, -0.50806, 0.65029, -0.0154288, 0.0965966, -0.0509648, -1.07693, -0.0720484, 0.0168191, -0.748985, -0.514168, 0.0334059, 0.525347, 0.0106101, 0.351337, -0.295043, -0.0731751, 0.531675, 0.236159, -0.048793, 0.0839801, -0.0296137, 0.326035, 0.453188, 0.0256332, -0.00153789, 0.0274675, -0.0939737, -0.0458581, 0.630918, -0.723277, 0.375921, -0.38443, -0.405859, -0.42589, 0.0753447, 0.0381474, 0.00303055, -0.00270887, 0.0872756, 0.0581449, -0.155469, -1.91562, -0.189323, -1.9802, -0.0673124, -0.177135, -0.344726, 0.24487, 0.124171, 0.630217, 0.0277712, -0.000109492, 0.195247, 0.0911372, 0.132786, -0.0627052, 0.000557234, -0.0574636, -0.107115, -0.0114648, -0.0106811, 0.0238656, 0.907109, 0.0730072, 0.0829421, 0.223697, 0.00663885, -0.0439303, -0.0126327, 0.12391, 0.0290187, -0.0138738, 0.316217, 0.0297654, -0.00529739, 1.47335, 0.0862548, 0.445611, 0.399455, -0.421059, -0.513143, -0.488344, 0.0634318, -0.0582027, -0.868212, -1.21112, 0.275087, -0.0359629, -0.0944548, 0.0483943, 0.0973041, 0.0184015, -0.315908, 0.117088, -1.5984, 0.192912, 0.126915, -1.29477, -0.0798459, -0.0742269, -0.0673245, 0.0667747, -0.0524924, -0.00539848, -0.96462, -0.076638, -0.337275, 0.300756, 0.0759242, -0.130211, 0.00312355, 0.00541164, 0.145865, -0.0570382, -0.0239117, -0.392723, 0.306489, 0.0989485, 0.161353, -0.061949, -0.0703728, -0.0616233, 1.8263, -0.0181871, -0.189043, -0.149364, 0.542206, 0.165657, 0.277165, -0.244566, 0.0468249, 0.0291341, -0.0270415, 0.0312057, 0.0430467, -0.0448855, -2.5228, -2.9772, -0.196401, -0.221129, -0.0732101, 0.231192, 0.0451684, -0.0152368, 0.0766133, -0.0311831, 0.0268148, -0.0965556, 0.0165323, 0.424352, 0.431537, -0.115098, -0.0671726, 0.050878, -0.228588, -0.0320951, 0.0109804, -0.00443073, 0.322013, 0.11805, 0.0665268, 0.0913105, 0.0382813, -0.0587592, 0.0775292, -0.0590423, -0.0336704, -0.0882466, -0.0605188, -0.0261214, 0.0780704, 0.0804327, 0.0419754, 0.0887953, 0.0175581, 0.0709167, -0.0740057, 0.0714341, 0.0135452, 0.00567058, 0.0413847, -0.00396382, -0.0342364, 0.0302701, 0.00729011, -0.0312868, -0.0951013, -0.000557894, -0.00653256, 0.00146915, 0.0666626, -0.069807, 0.0461506, -0.0427751, 0.0418614, 0.0403386, 0.0491452, -1.22081, -0.0422374, -0.0839421, 0.562653, -1.29411, -0.0441502, 0.993485, -0.0120128, 0.506275, 0.0105877, 0.159929, 0.130383, 0.196676, -0.015407, -0.00123731, 0.087561, 0.229457, 0.339057, -0.119564, 0.0623738, 0.00654184, -0.940877, -0.0969259, -0.0673898, -1.5149, -0.247576, -0.0212856, -0.230723, 0.0576778, 0.00159043, -0.0981258, -0.00934583, -3.38997, -0.0755664, 0.0488917, 0.0482809, 1.09353, -0.0987566, 0.369248, -0.0196801, -0.253582, 0.337186, -0.0462551, 0.426998, 0.134016, -0.0753207, 0.360401, 0.418433, 0.496426, 0.111532, -0.0805398, -0.0258309, 0.0416391, 0.400968, -0.0758908, 0.0985913, 0.174062, 1.15123, 0.0972032, 0.374585, 0.895324, -0.0360558, 0.0351568, -0.0212286, 0.0909887, -0.00754702, 0.0712303, 0.0339259, -0.102061, 0.000449781, -0.00547831, -0.049231, -0.0575407, -0.0618923, -0.0655025, 0.065768, -0.0442545, 0.0724839, 0.0161549, 0.0162397, 0.0977461, -0.0730475, 0.0755586, -0.0165801, 0.0670332, -0.0394581, -0.0436924, 0.00214217, 0.0143447, -0.139079, 0.00179966, -0.12965, 0.0216434, 0.00943201, 0.0806736, -0.0152959, 0.072332, 0.0515691, -0.0864722, 0.00815889, 0.100709, -0.0219429, 0.00934086, -0.017351, -0.0206008, -0.0696369, -0.0403118, -0.0616514, -0.129272, 0.0521791, -0.0253346, -0.0162351, 0.0489281, -0.10597, 0.0482984, 0.0967206, -0.0205226, 0.0470737, -0.0611964, -0.000640807, -0.122497, -0.0666772, 0.00844512, -0.11008, 0.029232, -0.000961622, -0.0557856, 0.0189771, -1.99311, -0.032777, 0.0473166, 0.0270926, -0.720774, 0.0821727, 0.446347, -0.0175678, 0.328618, -0.183908, -0.0979357, 0.334797, 0.134748, 0.0547075, 0.0123757, -0.123267, 0.657703, 0.644283, 0.0341843, 0.0186149, -0.0311217, 0.0343879, 0.0758007, 0.598206, -1.30281, 0.953107, -0.578957, 0.151592, 0.163383, -0.0325036, 0.0288445, -0.0758729, -0.0745886, -0.0509449, -0.073199, 0.0486236, 0.0517351, 0.0447422, -0.0636593, 0.0456083, -0.0806179, 0.0402401, 0.0269777, 0.0235309, -0.0755636, -0.0622144, -0.0601497, -0.0401578, -0.0248754, -0.0394277, -0.063021, 0.0104877, -0.0685731, 0.0324944, 0.00337209, 0.00780529, 0.00235423, 0.00281539, 0.0476179, -0.002499, -0.00275207, -0.0293776, -0.0125687, 0.126219, -2.46081, 0.0445898, -0.0735612, 0.109498, 0.413921, 0.216445, 0.409219, 0.0681723, -0.406121, 0.217599, 0.0831874, 0.27698, 0.152919, -0.0332992, 0.155149, 0.482963, 1.0571, 0.503183, -0.0736382, 0.0160109, 0.0811454, 0.800069, 0.00713059, 0.0277941, -0.350131, -0.808852, -0.022215, -0.843206, -0.878151, -0.0511771, 0.027818, -0.0694579, 0.0255353, 0.040573, -0.0722984, -2.50253, -4.23282, -0.133413, -0.598841, 0.0744529, 0.151021, -0.181172, 0.312289, 0.21636, -2.01185, 0.0290732, 0.250248, 0.339476, 0.336979, 0.34585, 0.0495431, 0.00872116, 0.0755172, -0.854718, 0.070201, 0.047017, 0.0269805, -0.238271, 0.13368, 0.00503913, 0.14031, -0.0129501, -0.0280706, -0.0267394, -0.255915, -0.0766277, -0.0405725, -0.0188499, -1.5402, -0.30387, -0.390158, -0.0771005, -0.0671609, -0.172923, 0.301517, 0.5605, 0.306441, -0.0725342, 0.822218, 0.226335, 0.333611, 2.57793, -0.0159178, -0.0375858, -0.0179162, -0.759593, -0.0346731, 0.463632, -0.858474, 0.670119, -0.365669, 0.323772, 0.572422, -0.0327384, 0.00683436, 0.075505, -2.60292, 0.044801, -0.0982027, -0.357807, -0.292285, -0.164566, 0.0384382, -0.0920943, 0.520493, -0.0965391, -0.218124, 0.208973, 0.138903, -0.0750148, 0.410405, -0.257127, 0.564118, -0.33644, 0.0234593, -0.0889506, -0.0172455, 0.27045, -0.0488787, 0.557087, -1.53173, 0.378648, -0.421879, 0.48997, 0.527777, -0.00892524, -0.00473421, 0.0479829, 0.206134, -0.0637182, 0.0464725, -0.1728, 0.979198, -0.23087, 1.10242, 0.0185839, 0.0542783, 0.484806, -1.00545, 0.1224, -0.383661, 0.0939261, -0.241159, 0.151847, -0.0525167, -0.14846, -0.0870204, 0.000471259, 0.0894825, 0.947094, -0.0101241, -0.243905, 0.0752995, -1.3132, 0.154279, 0.205067, -0.823191, 0.026083, -0.0152302, -0.0896765, -0.0636286, -0.107081, 0.00607641, -1.41222, -4.61128, -0.119208, -0.032626, -0.00494119, -0.00707942, -0.330314, 0.335407, 0.28681, 0.0772787, 0.0157325, -0.0785916, 0.614266, 0.528326, 0.311129, -0.154936, -0.0821054, 0.0454072, -0.418881, -0.0412969, -0.0117491, -0.0164951, -0.307524, 0.167243, 0.0572605, 0.12534, 0.046439, 0.0575705, 0.0228931, -0.0705184, 0.0357576, -0.0576542, -0.052927, -0.0664092, 0.0597029, 0.00423153, -0.0431771, -0.0520671, -0.0988854, 0.0802968, -0.0116057, -0.0454235, 0.00313078, -0.0932786, 0.0235234, 0.0280465, -0.0129083, 0.0414059, 0.00568983, 0.0135819, -0.107641, 0.0434539, 0.0543635, 0.0779106, 0.0719157, -0.0657962, 0.002264, -0.0731827, 0.0812552, -0.015185, 0.0304134, 0.0730854, -0.0852953, -0.0982879, -0.311596, 1.19156, 0.0977963, 0.562891, -0.0191476, 0.83584, -0.395601, -0.151677, -0.682096, -0.582474, 0.051714, -0.0618597, -0.784247, -5.37093, -0.726937, 0.0143626, 0.074664, 0.016882, 1.20026, -0.0650847, -0.156312, 0.0150043, -0.242617, -0.231405, 0.122081, 0.0611191, 0.0167614, -0.0813167, -0.108669, 0.00996006, 0.0542048, -0.014338, -2.21962, -3.89284, -0.178711, -0.14934, -0.00178577, 0.0552535, -0.0697514, 0.297472, 0.306629, -1.1544, 0.0888981, 0.66901, 0.173491, 0.586815, 0.0612302, 0.013008, 0.007358, 0.0500105, -0.41027, 0.0523083, 0.0279833, 0.00107057, -0.433152, 0.152427, 0.0329987, 0.104989, -0.2048, 0.0877225, 0.378767, -0.100373, -0.100424, 0.276287, -0.109914, 0.130957, 0.0376526, 0.0861831, 0.457785, 0.172049, 0.0293966, 0.174022, 0.211984, 0.0209974, -0.183875, 0.237532, 0.0816056, -0.139426, -0.127076, 0.331096, -0.14218, 0.401257, 0.0435033, 0.174456, 0.456934, 0.222609, 0.026783, -0.129528, 0.116793, 0.00760834, 0.0364673, 4.85477, 3.43815, -0.0726472, -0.0399821, 0.200845, -0.0679909, -1.44518, 1.65911, 2.20198, 4.55093, 2.76009, 2.03497, -2.88009, 0.0358011, 4.65873, -0.0766303, 1.95453, 1.07833, -0.0308245, -0.0140635, 3.38169, -0.0558733, -0.117451, 3.51591, 0.833492, 3.25813, -0.0321352, 4.79528, 0.00869339, -4.49065, 4.13675, -0.0915529, 0.0804248, -0.0678195, -0.0289652, 0.01651, -2.18645, 0.0982759, 0.782714, -0.0866118, -0.254623, -0.793064, -4.94081, 0.191054, 1.39018, -1.98585, -1.47513, 0.0856603, 0.807614, -1.97281, -0.0379298, -0.0103872, -0.783942, 0.00895016, -1.93477, -0.0466187, 0.374282, -3.04227, -1.76444, -0.141184, 0.0384393, 0.515447, -0.0980714, 0.031348, -0.387932, -0.398795, 0.0514495, 0.0361159, 0.680814, 0.00268486, 1.30738, -1.48383, -1.68689, -4.42981, -2.06283, -1.54672, 2.17849, -0.0167344, -1.35357, -0.0624736, -0.0860866, -1.79333, 0.0254768, -0.027689, -1.70434, 0.058219, 1.37985, -4.85546, -1.26323, -3.71705, 0.763023, -1.99912, -0.0614102, 2.17746, -4.43802, -0.0253169, -0.346827, 0.0931686, 0.0642204, -0.0796111, 0.377884, 0.0239155, -0.0148369, 0.0379486, 0.896272, -0.348193, -0.00998817, 0.0970713, 0.344224, 0.272577, 0.295166, -0.0714833, 0.137709, 0.184874, -0.0684922, -0.00717925, -0.398002, 0.0121386, -0.304759, 0.027437, 0.130338, -0.0392715, 0.0713837, -0.038419, 0.0431628, -0.077998, -0.587105, 0.984897, 0.581033, 0.883129, -0.217157};
    int i=0;

    float24_t mem1[32];
    uint1_t spike1[32];
    float24_t mem2[32];
    uint1_t spike2[32];
    float24_t mem3[32];
    uint1_t spike3[32];
    float24_t mem_out[4];
    uint1_t spike_out[4];
    uint1_t spike_sum[4];

    TimeLoop:
    for(int time=0; time<130; time++){
        fc1(ecg[time], ecg[time+130], mem1, spike1, data);
        fc2(spike1, mem2, spike2, data);
        fc3(spike2, mem3, spike3, data);
        fc2(spike3, mem_out, spike_out, data);
        for(i=0; i<4; i++){
            spike_sum[i] += spike_out[i];
        }
    }
    int max=0;
    MaxLoop:
    for(i=0; i<4; i++){
        if(max<spike_sum[i]){
            max = spike_sum[i];
            *result = i;
        }
    }
}


